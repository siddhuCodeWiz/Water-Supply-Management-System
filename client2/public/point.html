<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""/>

    <!-- <link rel="stylesheet" href="./style.css"> -->
    <!-- <link rel="stylesheet" href="./style.css"> -->

    <link rel="stylesheet" href="https://ppete2.github.io/Leaflet.PolylineMeasure/Leaflet.PolylineMeasure.css" />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />

    <!-- <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.9.4/dist/leaflet.draw.css" /> -->

    <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css" />
<style>#map{
    height: 100vh;
  }</style>
   
</head>
<body>
    <div id="map"></div>

    <!-- JQuery Link -->
    <script src="./jquery.js"></script>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""></script>

    <!-- Leaflet Providers -->
    <script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>

    <script src="./leaflet-providers.js"></script>

    <script src="https://ppete2.github.io/Leaflet.PolylineMeasure/Leaflet.PolylineMeasure.js"></script>
    <!-- <script src="./new_script.js"></script> -->
    <!-- <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script> -->

    
     <!-- <script src="https://unpkg.com/leaflet-draw@1..4/dist/leaflet.draw.js"> -->
<script>
var osmMap = L.tileLayer.provider('OpenStreetMap.Mapnik');
var streetMap = L.tileLayer.provider('Esri.WorldStreetMap');
// var fs = require('fs');

// Adding the base Maps which we want from the Leaflet-Provider Plugin
var baseMaps ={
  OSM: osmMap,
  'Street Map': streetMap
}
// export function lanlat(coordinates){
//   let arr = [];
//     // Loop through the coordinates array for each point in the line
//     for (var i = 0; i < coordinates.length; i++) {
//       var latitude = coordinates[i][1];
//       var longitude = coordinates[i][0];
//       arr.push(latitude, longitude);
//       // Now you can use latitude and longitude for each point in the line
//       // console.log('Point ' + (i + 1) + ' - Latitude:', latitude);
//       // console.log('Point ' + (i + 1) + ' - Longitude:', longitude);
//     }
//     console.log(arr);
//     let myArray =arr;
//     myArray.reverse();
//     let subarrays=[];
//     for (let i = 0; i < myArray.length; i += 2) {
//       let subarray = myArray.slice(i, i + 2);
//       subarrays.push(subarray);
//     }

// }



// Declaring useful variables
var geoServerIPPort = 'localhost:8080';
var geoServerWorkspace = 'siddharth';
var stateLayerName = 'siddharth:main_water_lines_pg';

// Adding a layer from geoserver (Works only if geoserver's application is running in bg)
var mainWaterLineLayer = L.tileLayer.wms(
  "http://localhost:8080/geoserver/siddharth/wms",
  {
    layers: 'siddharth:Main_Water_Lines_nonpg',
    format: "image/png",
    transparent: true,
    version: "1.1.0",
    tiled: true,
  }
)

var houseConnectsLayer = L.tileLayer.wms(
  "http://localhost:8080/geoserver/siddharth/wms",
  {
    layers: '	siddharth:House_Connects_nonpg',
    format: "image/png",
    transparent: true,
    version: "1.1.0",
    tiled: true,
  }
)

var waterTanksLayer = L.tileLayer.wms(
  "http://localhost:8080/geoserver/siddharth/wms",
  {
    layers: '	siddharth:House_Connects_nonpg',
    format: "image/png",
    transparent: true,
    version: "1.1.0",
    tiled: true,
  }
)

// declaring all the layers with names in a object
var overlayMaps = {
  "Main Water Line": mainWaterLineLayer,
  "House Connects" : houseConnectsLayer,

};

// Defining the look of the map and declaring the layers
var map = L.map('map', {
  center: [17.3981383, 78.4890028],
  zoom: 16,
  layers:[osmMap, mainWaterLineLayer, houseConnectsLayer],
})

// Adding the layers to the map
var mapLayer = L.control.layers(baseMaps, overlayMaps).addTo(map);

// Showing a layer by importing the geoJSON file.
// var water_resorces =$.getJSON("./resources/stanford_geojson.json" ,function(data){
//   L.geoJSON(data).addTo(map);
// })

// var water_resorces =$.getJSON("./points.json" ,function(data){
//   L.geoJSON(data).addTo(map);
// })

$.getJSON('./lines.json', function (data) {
  L.geoJSON(data, {
    style: function (feature) {
      return {
        color: 'blue',  // Set the line color
        weight: 2        // Set the line weight
      };
    },
    onEachFeature: function (feature, layer) {
      layer.bindPopup(feature.properties.name);
    }
  }).addTo(map);
});

$.getJSON('./points.json', function (data) {
  L.geoJSON(data, {
    pointToLayer: function (feature, latlng) {
      return L.marker(latlng).bindPopup(feature.properties.name);
    }
  }).addTo(map);
});




// var cltMeasure = L.control.polyline


// Drawing a layer on map
var drawnItems = new L.FeatureGroup();
map.addLayer(drawnItems);

var drawControl = new L.Control.Draw({
    position: 'bottomright',
    edit: {
        featureGroup: drawnItems,
    },
    draw: {
        marker: true,
        polyline: true,
        polygon: true,
        circle: true,
    },
});

map.addControl(drawControl);


// Retrieving the above drawn data


map.on('draw:created', function (e) {
  // alert("I am")
  var layer = e.layer;
  drawnItems.addLayer(layer);
  // Access the shape data and do something with it
  var shapeData = layer.toGeoJSON();
  // Store or process the shapeData as needed

  // Check if it's a Point geometry (Marker)
  if (shapeData.geometry.type === 'Point') {
    coordinates = shapeData.geometry.coordinates;
    var latitude = coordinates[1];
    var longitude = coordinates[0];
  //   map.on('click', function (e) {
  // var latitude = e.latlng.lat;
  // var longitude = e.latlng.lng;
  // console.log('Clicked at:', lat, lng);
    // Now you can use latitude and longitude as needed
    // console.log('Latitude:', latitude);
    // console.log('Longitude:', longitude);
    const textToAppend = "Hello World";
    var mas = latitude+", "+longitude;
    alert(mas);
  }

  else if (shapeData.geometry.type === 'LineString') {
    coordinates = shapeData.geometry.coordinates;
    latlan(coordinates);
    let arr = [];
    // Loop through the coordinates array for each point in the line
    for (var i = 0; i < coordinates.length; i++) {
      var latitude = coordinates[i][1];
      var longitude = coordinates[i][0];
      arr.push(latitude, longitude);
      // Now you can use latitude and longitude for each point in the line
      // console.log('Point ' + (i + 1) + ' - Latitude:', latitude);
      // console.log('Point ' + (i + 1) + ' - Longitude:', longitude);
    }
    console.log(arr);
    let myArray =arr;
    myArray.reverse();
    let subarrays=[];
    for (let i = 0; i < myArray.length; i += 2) {
      let subarray = myArray.slice(i, i + 2);
      subarrays.push(subarray);
    }
}
});
map.on('draw:edited', function (e) {
  var layers = e.layers;
  layers.eachLayer(function (layer) {
    // Access and update the edited shape data
    var shapeData = layer.toGeoJSON();
    // Store or process the shapeData as needed
  });
});

map.on('draw:created', function (e) {
  var layer = e.layer;
  // Add your code to handle the drawn shape here
  // For example, set a custom property:
  layer.options.name = "My Line";
  layer.addTo(map);
});


map.on('click', function (e) {
  // Check if a line was clicked
  if (e.layer instanceof L.Polyline) {
    var lineName = e.layer.options.name;
    alert("Line Name: " + lineName);
  }
});


// ===============================================================================================================================

</script> 
    
</body>
</html>